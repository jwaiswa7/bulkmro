<div class="col-lg-12">
  <%#= render partial: "add_packing" %>
  <%#= render 'shared/snippets/page_header', e: @packing_slip %>

  <%= simple_form_for(:packing_slip, :url => submit_packing_overseers_outward_dispatch_packing_slips_path(@outward_dispatch), :html => {:class => 'needs-validation', :id => 'packing', :'novalidate' => '', :'data-parsley-validate' => ''}) do |f| %>
    <%#= render 'shared/snippets/form_errors', f: f %>
    <%#= f.hidden_field :id %>
    <%#= f.hidden_field :outward_dispatch_id %>
    <%#= f.hidden_field :sales_order_id %>
    <div class="card mb-2">
      <div class="card-body">
        <div class="">
          <h6 class="text-uppercase text-black-50 mb-1"> Entity Details</h6>
          <div class="form-row">

          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="error bg-danger text-white mb-3 px-1 rounded"></div>
        <h6 class="text-uppercase text-black-50 mb-1">Products</h6>
        <div class="form-row d-none d-md-flex mb-1">
          <div class="col-1">
            <div class="form-group mb-0">
              <label>Sr. No.</label>
            </div>
          </div>
          <div class="col-5 col-md-7">
            <div class="form-group mb-0">
              <label>Product</label>
            </div>
          </div>
          <div class="col-2 col-md-1">
            <div class="form-group mb-0">
              <label>Quantity</label>
            </div>
          </div>
          <div class="col-2 col-md-1">
            <div class="form-group mb-0">
              <label>Box numbers</label>
            </div>
          </div>
          <div class="col-2 col-md-1">
            <div class="form-group mb-0">
              <label>Quantities</label>
            </div>
          </div>
        </div>
        <% @packing_rows.each_with_index do |row, index| %>
          <%= hidden_field_tag "product_id[#{index}]", row[:product_id] ||row.product_id %>
          <%= hidden_field_tag "row[#{index}][product_id]",  row[:product_id] || row.product_id %>
          <%= hidden_field_tag "row[#{index}][ar_invoice_request_row_id]", row[:id] || row.id %>
          <div class="flex-grow-1">
            <div class="form-row flex-row align-items-start mb-1">
              <div class="col-1">
                <%= index + 1 %>
              </div>
              <div class="col-5 col-md-7">
                <%= row[:product_name] ||row.product.to_s %>
              </div>
              <div class="col-2 col-md-1">
                <%= row[:get_remaining_quantity] || row.get_remaining_quantity %>
                <%#= field_set_tag row.quantity, readonly: true %>
              </div>
              <div class="col-2 col-md-1">
                <%= text_field_tag "row[#{index}][box_numbers]", "", class: 'form-control', multiple: true, value: row[:box_number] %>
              </div>
              <div class="col-2 col-md-1">
                <%= text_field_tag "row[#{index}][quantities]", "", class: 'form-control', multiple: true, value: row[:box_number] %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="card-footer">
        <div class="form-row">
          <%= button_tag(type: "submit", class: "btn btn-success btn-block packing-form") do %>
            <i class="fal fa-plus-circle"></i> Add Packing Slip
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>