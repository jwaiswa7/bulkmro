
<div class="form-row d-none d-md-flex">
  <div class="col-12 col-md-6">
    <div class="form-row">
      <div class="col-12 col-md-1">
        <div class="form-group mb-0">
          <label>Sr. No.</label>
        </div>
      </div>
      <div class="col-12 col-md-3">
        <div class="form-group mb-0">
          <label>Product</label>
        </div>
      </div>


      <div class="col-12 col-md-1">
        <div class="form-group mb-0">
          <label>Make</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>HSN</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>T. Rate</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>Quantity</label>
        </div>
      </div>
      <div class="col-12 col-md-1">
        <div class="form-group mb-0">
          <label>Discount %</label>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="form-row">

      <div class="col-12 col-md-1">
        <div class="form-group mb-0">
          <label>UOM</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>UP</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>TP</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>TT</label>
        </div>
      </div>
      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>TP with tax</label>
        </div>
      </div>

      <div class="col-12 col-md-2">
        <div class="form-group mb-0">
          <label>Lead Time</label>
        </div>

      </div>
      <div class="col-12 col-md-1">
        <div class="form-group mb-0">
          <label>Remove</label>
        </div>

      </div>
    </div>
  </div>
</div>

<%= po_request.nested_fields_for :rows do |po_request_row| %>
  <%= po_request_row.hidden_field :id %>
  <%= po_request_row.hidden_field :sales_order_row_id %>
  <%= po_request_row.hidden_field :product_id %>
  <%= po_request_row.hidden_field :tax_code_id %>
  <%= po_request_row.hidden_field :tax_rate_id %>
  <%= po_request_row.hidden_field :measurement_unit_id, value: po_request_row.object.measurement_unit_id || MeasurementUnit.default.id %>
  <div class="form-row po-request-row">
    <div class="col-12 col-md-6">
      <div class="form-row">
        <div class="col-12 col-md-1">
          <%= po_request_row.input :sr, input_html: {value: ((po_request.object.rows.index(po_request_row.object) || 0) + 1)}, label: false, disabled: true %>
        </div>
        <div class="col-12 col-md-3">
          <div class="select2-wrap">
            <%= po_request_row.association :product, collection: [po_request_row.object.product], label_method: :to_s, include_blank: "Type SKU number, name, or brand", input_html: {class: 'select2-ajax select2-wrap-text', :'data-source' => service_autocomplete_overseers_products_path, :'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''}, label: false, disabled: po_request_row.object.field_disabled? %>
          </div>
        </div>


        <div class="col-12 col-md-1">

          <%= po_request_row.input :brand, input_html: {value: po_request_row.object.product.try(:brand).to_s}, label: false, disabled: true %>
          <%#= po_request_row.association :brand, label_method: :to_s, collection: selected_option_or_nil(po_request_row, :brand), include_blank: "Type to search", input_html: {class: 'select2-ajax', :'data-source' => autocomplete_overseers_brands_path}, disabled: po_request_row.object.field_disabled?, label: false, po_request.object.rows.first == po_request_row.object ? "Make" : false  %>
        </div>
        <div class="col-12 col-md-2">
          <%#= po_request_row.input :tax_code, label: false, po_request.object.rows.first == po_request_row.object ? "HSN" : false, disabled: po_request_row.object.field_disabled? %>
          <%= po_request_row.association :tax_code, label_method: :to_s, collection: selected_option_or_nil(po_request_row, :tax_code), include_blank: "Type to search", input_html: {class: 'select2-ajax select2-wrap-text', :'data-source' => autocomplete_overseers_tax_codes_path(is_service: !po_request_row.object.field_disabled?)}, label: false, required: true %>
        </div>
        <div class="col-12 col-md-2">
          <%#= po_request_row.input :tax_rate, label: false, po_request.object.rows.first == po_request_row.object ? "T. rate" : false, disabled: po_request_row.object.field_disabled? %>
          <%= po_request_row.association :tax_rate, collection: TaxRate.all, label_method: :to_s, include_blank: false, label: false %>
        </div>
        <div class="col-12 col-md-2">
          <%= po_request_row.input :quantity, input_html: {value: po_request_row.object.quantity, max: po_request_row.object.quantity, min: 0}, label: false, disabled: false, required: true %>
        </div>
        <div class="col-12 col-md-1">
          <%= po_request_row.input :discount_percentage, input_html: {value: po_request_row.object.discount_percentage}, label: false, disabled: false %>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="form-row">

        <div class="col-12 col-md-1">
          <%= po_request_row.input :measurement_unit, value: po_request_row.object.measurement_unit || MeasurementUnit.default, label: false, disabled: true %>
        </div>
        <div class="col-12 col-md-2">
          <%= po_request_row.input :unit_price, label: false, readonly: po_request_row.object.field_disabled?, required: true %>
        </div>
        <div class="col-12 col-md-2">
          <%= po_request_row.input :converted_total_selling_price, input_html: {value: po_request_row.object.converted_total_selling_price}, label: false, disabled: true %>
        </div>
        <div class="col-12 col-md-2">
          <%= po_request_row.input :converted_total_tax, input_html: {value: po_request_row.object.converted_total_tax}, label: false, disabled: true %>
        </div>
        <div class="col-12 col-md-2">
          <%= po_request_row.input :converted_total_selling_price_with_tax, input_html: {value: po_request_row.object.converted_total_selling_price_with_tax}, label: false, disabled: true %>
        </div>

        <div class="col-12 col-md-2">
          <% lead_time = (po_request_row.object.sales_order_row.nil?) ? "NA" : po_request_row.object.sales_order_row.sales_quote_row.lead_time_option.to_s %>
          <%= po_request_row.input :lead_time_option, input_html: {value: lead_time}, label: false %>
        </div>
        <div class="col-12 col-md-1">
          <%= po_request_row.remove_nested_fields_link do %>
            <div class="form-group align-self-center flex-grow-1 ml-2">
              <i class="far fa-times text-danger"></i>
            </div>
          <% end if policy(po_request_row.object).destroy? %>
        </div>
      </div>
    </div>
  </div>
<% end %>
<div class="col-md-3">
  <%= po_request.add_nested_fields_link :rows, class: 'btn btn-outline-success btn-block mb-2 mb-md-0' do %>
    <i class="fal fa-plus-circle mr-1"></i>Add a Service product
  <% end %>
</div>