<% content_for :page_title do %>
  Edit Supplier RFQ
<% end %>
<div class="col-lg-12">
  <%= render layout: 'overseers/inquiries/tabs_layout' do %>
    <div class="card">
      <div class="card-header">
        <div class="form-row">
          <% if @supplier_rfqs.present? %>
            <div class="col-md-3 pl-3">
              <span class="custom-control custom-checkbox d-inline">
                <%= check_box_tag 'select_all_isps', true, false, id: "select_all_isps", class: 'custom-control-input' %>
                <label class="custom-control-label" for="select_all_isps">Select All</label>
              </span>
            </div>
            <div class="col-md-2">
              <%= button_tag(type: "submit", class: "btn btn-m btn-block btn-warning bmro-button update-all", value: 'update') do %>
                Update All
              <% end %>
            </div>
            <div class="col-md-4">
              <%= button_tag(type: "submit", class: "btn btn-m btn-block btn-warning bmro-button update-and-send-link-all", value: 'update_and_send_link_all') do %>
                Update and Send link to All
              <% end %>
            </div>
            <div class="col-md-3">
              <%= button_tag(type: "submit", class: "btn btn-m btn-block btn-warning bmro-button btn-block rfq-review") do %>
                RFQ Review
              <% end %>
            </div>

          <% else %>
            RFQ records not found.
          <% end %>
        </div>
      </div>
    </div>
    <div>
      <% @supplier_rfqs.each do |supplier_rfq| %>
        <%= simple_form_for([:overseers, @inquiry, supplier_rfq], :html => {:class => 'needs-validation mt-3 update-isp', :'novalidate' => '', :'data-parsley-validate' => ''}) do |f| %>
          <%= render 'shared/snippets/form_errors', f: f %>

        <div class="card">
          <div class="card-body">
            <div class="form-row">
              <%= f.hidden_field :id %>
              <%= f.hidden_field :inquiry_id %>
              <div class="col-12">
                <% shown_title = false %>
                  <div class="form-group mb-0">
                    <% if supplier_rfq.attachments.attached? %>
                      <strong>Supplier RFQ Documents</strong>
                      <% supplier_rfq.attachments.each do |attachment| %>
                        <%= link_to url_for(attachment), class: 'ml-md-1 btn', target: '_blank', :"data-toggle" => 'tooltip', :status => attachment.filename do %>
                          <i class="fal fa-download" title="<%= attachment.filename %>"></i>
                        <% end %>
                      <% end %>
                      <hr>
                    <% end %>
                  </div>
                <%= f.nested_fields_for :inquiry_product_suppliers, f.object.inquiry_product_suppliers do |inquiry_product_supplier| %>
                  <%= hidden_field_tag :inquiry_product_supplier, inquiry_product_supplier.object.id, 'data-name': inquiry_product_supplier.object.to_s  %>
                  <% if inquiry_product_supplier.object.id.present? %>
                    <% if @isp_ids.present? %>
                      <% if @isp_ids.include?("#{inquiry_product_supplier.object.id}") %>
                        <%= render 'overseers/inquiries/supplier_rfqs/product_suppliers', inquiry_product_supplier: inquiry_product_supplier,  shown_title: shown_title %>
                      <% end %>
                    <% else %>
                      <%= render 'overseers/inquiries/supplier_rfqs/product_suppliers', inquiry_product_supplier: inquiry_product_supplier,  shown_title: shown_title %>
                    <% end %>
                    <% if f.object.inquiry_product_suppliers.count > 1 %>
                      <hr>
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
    </div>
  <% end %>
</div>
