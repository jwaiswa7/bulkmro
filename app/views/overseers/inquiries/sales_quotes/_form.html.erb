<div class="col-lg-12">
  <%= render layout: 'overseers/inquiries/tabs_layout' do %>
    <%= simple_form_for([:overseers, @inquiry, @sales_quote], :html => {:class => 'card'}) do |f| %>
      <%= f.hidden_field :inquiry_id %>
      <%= f.hidden_field :parent_id %>
      <%= render 'shared/snippets/form_errors', f: f %>

      <div class="card-header">
        <div class="form-row">
          <div class="col-md-3">
            <%= f.input :calculated_total, disabled: true, input_html: {"data-v-model": ""}, label: 'Total Selling Price (Excl. tax)' %>
          </div>
          <div class="col-md-3">
            <%= f.input :calculated_total_tax, disabled: true, input_html: {"data-v-model": ""}, label: 'Total Tax' %>

          </div>
          <div class="col-md-3">
            <%= f.input :calculated_total_with_tax, disabled: true, input_html: {"data-v-model": ""}, label: 'Total Selling Price (Incl. tax)' %>
          </div>
          <div class="col-md-3">
            <%= f.input :calculated_total_margin, disabled: true, input_html: {"data-v-model": ""}, label: 'Total Margin' %>
          </div>
        </div>
      </div>

      <div class="card-body">
        <div class="row">
          <%= f.simple_fields_for :inquiry_currency do |inquiry_currency| %>
            <div class="col-md-6">
              <%= inquiry_currency.association :currency, collection: Currency.all.map {|currency| [currency.to_s, currency.id, {'data-conversion-rate' => currency.conversion_rate}]}, include_blank: false, input_html: {"data-v-model": "", "data-v-on:change": "dropdownChanged"} %>
            </div>
            <div class="col-md-6">
              <%= inquiry_currency.input :conversion_rate, input_html: {"data-v-model": "", } %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="card-body">
        <div class="form-group">
          <% f.object.rows.group_by(&:inquiry_product).each do |inquiry_product, rows| %>

            <%= f.simple_fields_for :rows, rows.sort_by(&:unit_cost_price), wrapper_tag: :div do |row| %>
              <div class="row simple-row" data-index="<%= row.index %>">
                <%= inquiry_product.product.name %>
                <hr>
                <%= row.hidden_field :inquiry_product_id %>
                <%= row.hidden_field :inquiry_product_supplier_id, "data-bind": "" %>
                <%= row.hidden_field :sales_quote_id %>
                <%= row.hidden_field :id %>

                <div class="col-md-1"><%= radio_button_tag ['[sales_quote][selected_suppliers]', row.object.inquiry_product.id].join, row.object.inquiry_product_supplier.id, row.object.persisted? || rows[-1] == row.object, "data-bind": "select_supplier_#{row.object.inquiry_product.id}" %>
                </div>
                <div class="col-md-1"><%= row.input :sr_no, disabled: true %></div>
                <div class="col-md-2"><%= row.input :inquiry_product_supplier, as: :string, disabled: true, label: 'Supplier' %></div>
                <div class="col-md-2"><%= row.input :quantity, input_html: {"data-bind": ""} %></div>
                <div class="col-md-2"><%= row.input :freight_cost_subtotal, input_html: {"data-bind": ""}, label: 'Total FR' %></div>
                <div class="col-md-2"><%= row.input :unit_freight_cost, input_html: {"data-bind": ""}, label: 'UFC' %></div>
                <div class="col-md-2"><%= row.input :unit_cost_price, input_html: {"data-bind": ""}, label: 'UCP', disabled: true %></div>
                <div class="col-md-2"><%= row.input :unit_cost_price_with_unit_freight_cost, input_html: {"data-bind": ""}, label: 'UCP w/ F', disabled: true %></div>
                <div class="col-md-2"><%= row.input :margin_percentage, label: 'Margin %', input_html: {:min => 0, :max => 99.99, "data-bind": ""} %></div>
                <div class="col-md-2"><%= row.input :unit_selling_price, label: 'USP', input_html: {:min => 0, "data-bind": ""} %></div>
                <div class="col-md-2"><%= row.input :converted_unit_selling_price, disabled: true, label: '$USP', input_html: {:min => 0, "data-bind": ""} %></div>

                <div class="col-md-2"><%= row.association :tax_code, label_method: :to_s, include_blank: "Type to search", input_html: {:'data-source' => autocomplete_overseers_tax_codes_path, "data-bind": ""} %></div>
                <%= row.hidden_field :tax_percentage, "data-bind": "" %>
                <div class="col-md-2"><%= row.input :total_selling_price, input_html: {:min => 0, "data-bind": ""}, disabled: true %></div>
                <div class="col-md-2"><%= row.input :total_selling_price_with_tax, label: 'TSP w/ Tax', input_html: {:min => 0, "data-bind": ""}, disabled: true %></div>
                <div class="col-md-2"><%= row.association :lead_time_option %></div>
                <div class="col-md-2">

                </div>
              </div>
            <% end %>
          <% end %>
          <div class="row">
            <div class="col-md-12"><%= f.input :calculated_freight_cost_total, disabled: true, input_html: {"data-v-model": ""} %></div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <div class="form-row">
          <div class="col-6">
            <%= button_tag(type: "submit", class: "btn btn-warning btn-block") do %>
              <i class="fal fa-pen mr-1"></i> Save as Draft
            <% end %>
          </div>
          <div class="col-6">
            <%= button_tag(type: "submit", class: "btn btn-success btn-block") do %>
              <i class="fal fa-paper-plane mr-1"></i> Save and Send
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>