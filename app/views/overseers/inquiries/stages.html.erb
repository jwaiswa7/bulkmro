<div class="col-lg-12">
  <% content_for :heading_byline do %>
    This are the various <em>stages for <%= @inquiry %></em>.
  <% end %>
  <%= render layout: 'overseers/inquiries/tabs_layout' do %>
    <ul class="nav nav-tabs nav-fill">
      <li class="nav-item">
        <a class="nav-link active" href="#visual" data-toggle="tab">Visual</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#tabular" data-toggle="tab">Tabular</a>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade" role="tabpanel" id="tabular">
        <% provide :hide_table_desc, true %>
        <% provide :hide_table_heading, true %>

        <% content_for :header_row do %>
          <th class="no-sort all">Subject</th>
          <th class="no-sort all">Status</th>
          <th class="no-sort all">TAT</th>
          <th class="no-sort all">Date</th>
        <% end %>

        <%= render layout: 'shared/layouts/datatable' do %>
          <% @stages.each_with_index do |stage, index| %>
            <tr>
              <td>
                <% if stage.subject_type.present? && stage.subject_type != "Inquiry" %>
                  <%= link_to "#{stage.subject_type} ##{stage.subject_id}", stage.subject_type == "SalesOrder" ? overseers_inquiry_sales_order_path(stage.inquiry, stage.subject) : overseers_inquiry_sales_quote_path(stage.inquiry, stage.subject) %>
                <% else %>
                  <%= "Inquiry ##{stage.inquiry.inquiry_number}" %>
                <% end %>
              </td>
              <td data-filter="false"><%= stage.status %></td>
              <td data-filter="false"><%= index > 0 ? distance_of_time_in_words(stage.created_at, @stages[index - 1].created_at, {}).titleize : "0" %> </td>
              <td data-filter="false"><%= format_date_with_time(stage.created_at) %></td>
            </tr>
          <% end %>
        <% end %>
      </div>
      <div class="tab-pane fade active show" role="tabpanel" id="visual">
        <div class="treant-templates d-none">
            <script>
               function assignNodeStructure() {
                   $.get(Routes.relationship_map_overseers_inquiry_path(<%= @inquiry.id %>), function (response) {
                       console.log(response['data'])
                       if (response['data'] != undefined) {
                           var nodeStructure = response['data']
                           if (!$('.treant').exists()) return;
                           let config = {
                               chart: {
                                   container: ".treant",
                                   scrollbar: "native",
                                   connectors: {
                                       type: "step",
                                       style: {
                                           "stroke-width": 2,
                                           'stroke': '#fd7e14',
                                           'arrow-end': 'block-wide-long'
                                       }
                                   },
                               },
                               nodeStructure: nodeStructure
                           };

                           new Treant(config, function() {}, $);
                       }
                   })

                   //console.log('Inside view script is load')
               }
               assignNodeStructure()

            </script>
        </div>
        <div class="treant" style="width:100%; height: auto;"></div>
      </div>
    </div>
  <% end %>
</div>