<div class="col-lg-12">
  <% content_for :heading_byline do %>
    This are the various <em>stages for <%= @inquiry %></em>.
  <% end %>
  <%= render layout: 'overseers/inquiries/tabs_layout' do %>
    <ul class="nav nav-tabs nav-fill">
      <li class="nav-item">
        <a class="nav-link active" href="#visual" data-toggle="tab">Visual</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#tabular" data-toggle="tab">Tabular</a>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade" role="tabpanel" id="tabular">
        <% provide :hide_table_desc, true %>
        <% provide :hide_table_heading, true %>

        <% content_for :header_row do %>
          <th class="no-sort all">Subject</th>
          <th class="no-sort all">Status</th>
          <th class="no-sort all">TAT</th>
          <th class="no-sort all">Date</th>
        <% end %>

        <%= render layout: 'shared/layouts/datatable' do %>
          <% @stages.each_with_index do |stage, index| %>
            <tr>
              <td>
                <% if stage.subject_type.present? && stage.subject_type != "Inquiry" %>
                  <%= link_to "#{stage.subject_type} ##{stage.subject_id}", stage.subject_type == "SalesOrder" ? overseers_inquiry_sales_order_path(stage.inquiry, stage.subject) : overseers_inquiry_sales_quote_path(stage.inquiry, stage.subject) %>
                <% else %>
                  <%= "Inquiry ##{stage.inquiry.inquiry_number}" %>
                <% end %>
              </td>
              <td data-filter="false"><%= stage.status %></td>
              <td data-filter="false"><%= index > 0 ? distance_of_time_in_words(stage.created_at, @stages[index - 1].created_at, {}).titleize : "0" %> </td>
              <td data-filter="false"><%= format_date_with_time(stage.created_at) %></td>
            </tr>
          <% end %>
        <% end %>
      </div>

      <div class="tab-pane fade active show" role="tabpanel" id="visual">
        <div class="treant-templates d-none">
          <a class="card text-black-50 inquiry" target="_blank" href="{url}">
            <div class="card-header p-1">
              <span class="badge badge-wrap text-uppercase badge-danger float-right"><strong>Regret</strong></span>
              <strong>Inquiry</strong>
            </div>
            <div class="card-body p-1 text-center">
              <div class="subject">
                #{number}
              </div>
              <hr class="my-1">
              <div class="ise">
                {executive}
              </div>
              <hr class="my-1">
              <div class="subject">
                {subject}
              </div>
              <hr class="my-1">
              <div class="margin">
                {margin}%
              </div>
            </div>
          </a>
        </div>

        <script>
            var treantTemplate = function (template, json) {
                let t = $('.treant-templates').find(['.', template].join('')).get(0).outerHTML;
                for (let variable in json) {
                    t = t.replace(['{', variable, '}'].join(''), json[variable]);
                }
                return t;
            };

            var nodeStructure = {
                innerHTML: treantTemplate('inquiry', {
                    url: 'http://google.com',
                    number: '19293',
                    executive: 'Amit G.',
                    subject: 'Fwd: Something very imporant',
                    margin: '10'
                }),
                children: [{
                    innerHTML: treantTemplate('inquiry', {
                        url: 'http://google.com',
                        number: '19293',
                        executive: 'Amit G.',
                        subject: 'Fwd: Something very imporant',
                        margin: '10'
                    })
                }, {
                    innerHTML: treantTemplate('inquiry', {
                        url: 'http://google.com',
                        number: '19293',
                        executive: 'Amit G.',
                        subject: 'Fwd: Something very imporant',
                        margin: '10'
                    }),
                    children: [{
                        innerHTML: treantTemplate('inquiry', {
                            url: 'http://google.com',
                            number: '19293',
                            executive: 'Amit G.',
                            subject: 'Fwd: Something very imporant',
                            margin: '10'
                        })
                    }, {
                        innerHTML: treantTemplate('inquiry', {
                            url: 'http://google.com',
                            number: '19293',
                            executive: 'Amit G.',
                            subject: 'Fwd: Something very imporant',
                            margin: '10'
                        })
                    }]
                }]
            };
        </script>
        <div class="treant" style="width:100%; height: auto;"></div>
      </div>
    </div>
  <% end %>
</div>