<div class="col-lg-12">
  <% content_for :heading_button do %>
    <%= link_to overseers_inquiry_sales_orders_path(@inquiry), target: '_blank', class: "d-sm-block btn btn-dark btn-rounded align-self-center btn-block-sm-down" do %>
      <i class="fal fa-external-link mr-1"></i> Check Inquiry
    <% end %>
  <% end %>

  <% content_for :heading_byline do %>
    This will <em>'update/approve/reject <%= @inquiry %>'</em> and log it under
    <strong><%= current_overseer.full_name %></strong>.
  <% end %>

  <%= render layout: 'overseers/inquiries/tabs_layout' do %>



      <div class="card">
        <div class="card-body">
          <h5 class="card-title"><%= @sales_order %></h5>
          <div class="card-text">
            <div class="row">
              <div class="col-lg-6">Products: <strong><%= @sales_order.rows.size %></strong></div>
              <div class="col-lg-6">Created On: <strong><%= @sales_order.created_at.strftime("%d-%m-%Y")  %></strong></div>
              <div class="col-lg-6">Total Selling Price (Excl. tax): <strong><%= format_currency(@sales_order.calculated_total)%></strong></div>
              <div class="col-lg-6">Total Tax: <strong><%= format_currency(@sales_order.calculated_total_tax)%></strong></div>
              <div class="col-lg-6">Total Selling Price (Incl. tax): <strong><%= format_currency(@sales_order.calculated_total_with_tax)%></strong></div>
              <div class="col-lg-6">Total Margin: <strong><%= format_currency(@sales_order.calculated_total_margin) %></strong></div>

            </div>
          </div>

        </div>
      </div>



    <%= simple_form_for([:overseers, @inquiry.comments.build(:sales_order => @sales_order)], :html => {:class => 'needs-validation mt-3', :'novalidate' => '', :'data-parsley-validate' => ''}) do |f| %>
      <%= f.hidden_field :sales_order_id %>

      <%= render 'shared/snippets/form_errors', f: f %>

      <div class="card">
        <div class="card-body">
          <% if @comments.persisted.size > 0 %>
            <div class="chats mb-3">
              <% @comments.persisted.each do |comment| %>
                <div class="media chat-item">
                  <div class="media-body">
                    <div class="chat-item-title">
                      <span class="chat-item-author"><%= comment.created_by.full_name %></span>
                      <span><span class="mr-1"><strong><% if comment.approval.present? %><span class="badge badge-success">Approved</span><% end %>
                        <% if comment.rejection.present? %><span class="badge badge-danger">Rejected</span><% end %></strong></span><%= time_ago_in_words(comment.created_at) %>
                        ago</span>
                    </div>
                    <div class="chat-item-body">
                      <p><%= comment.message %></p>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>

          <%= f.input :message, required: true, :placeholder => 'Type message' %>

          <div class="flex-fill">
            <%= f.submit 'Reply', name: 'reply', class: 'btn btn-dark' %>
            <% if @sales_order.present? %>
              <%= f.submit 'Reply and Approve', name: 'approve', class: 'btn btn-success' if policy(@sales_order).approve? %>
              <%= f.submit 'Reply and Reject', name: 'reject', class: 'btn btn-danger' if policy(@sales_order).reject? %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>