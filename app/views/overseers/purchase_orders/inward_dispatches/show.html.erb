<div class="col-lg-12">
  <section class="pt-3 pt-lg-4 pb-2">
    <div class="d-md-flex justify-content-between">
      <h3 class="display-5 d-flex align-items-center">
        Inward Dispatch for #<%= @inward_dispatch.purchase_order.po_number %>
      </h3>
      <span>
        <% if policy(@inward_dispatch).edit? %>
        <a href="<%= edit_overseers_purchase_order_inward_dispatch_path(@inward_dispatch.purchase_order, @inward_dispatch) %>" class="btn btn-warning btn-rounded align-self-center btn-block-sm-down"><i class="fal fa-pen mr-1"></i>
          Edit Inward Dispatch</a>
      <% end %>
        <% if policy(@inward_dispatch).confirm_delivery? %>
        <a href="<%= confirm_delivery_overseers_purchase_order_inward_dispatch_path(@inward_dispatch.purchase_order, @inward_dispatch) %>" class="btn btn-success btn-rounded align-self-center btn-block-sm-down"><i class="fal fa-check mr-1"></i>
          Confirm Delivery</a>
      <% end %>
        <% if policy(@inward_dispatch).delivered? && policy(@inward_dispatch.purchase_order).can_request_invoice? %>
        <a href="<%= new_overseers_invoice_request_path(purchase_order_id: @inward_dispatch.purchase_order, mpr_id: @inward_dispatch) %>" class="btn btn-success btn-rounded align-self-center btn-block-sm-down"><i class="fal fa-plus mr-1"></i>
          Create GRPO Request</a>
      <% end %>

        <% if @inward_dispatch.purchase_order.po_request.present? && policy(@inward_dispatch).delivered? && policy(@inward_dispatch.purchase_order.po_request).new_payment_request? %>

            <a href="<%= new_overseers_po_request_payment_request_path(@inward_dispatch.purchase_order.po_request) %>" class="btn btn-success btn-rounded align-self-center btn-block-sm-down"><i class="fal fa-dollar-sign mr-1"></i> Create Payment Request
            </a>
              <% elsif @inward_dispatch.purchase_order.po_request.present? && policy(@inward_dispatch).delivered? && policy(@inward_dispatch.purchase_order.po_request).show_payment_request? %>
              <a href="<%= overseers_po_request_payment_request_path(@inward_dispatch.purchase_order.po_request) %>" class="btn btn-success btn-rounded align-self-center btn-block-sm-down"><i class="fal fa-dollar-sign mr-1"></i>
                View Payment Request</a>
        <% end %>
      </span>
    </div>
  </section>

  <section class="mb-3">
    <div class="card">
      <div class="card-body">
        <div>
          <h6 class="text-uppercase text-black-50 mb-1">Inward Dispatch Details</h6>
          <div class="form-row">
            <% if @inward_dispatch.purchase_order.present? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Purchase Order Number</strong>
                <%= @inward_dispatch.purchase_order.po_number %>
              </div>
            <% end %>

            <% if @inward_dispatch.status? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Status</strong>
                <%= @inward_dispatch.status.titleize %>
              </div>
            <% end %>

            <% if @inward_dispatch.logistics_owner.present? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Logistics Owner</strong>
                <%= @inward_dispatch.logistics_owner.full_name %>
              </div>
            <% end %>

            <% if @inward_dispatch.dispatched_by? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Material Dispatched By</strong>
                <%= @inward_dispatch.dispatched_by %>
              </div>
            <% end %>

            <% if @inward_dispatch.shipped_to? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Material Shipped To</strong>
                <%= @inward_dispatch.shipped_to %>
              </div>
            <% end %>

            <% if @inward_dispatch.logistics_aggregator.present? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Logistics Aggregator</strong>
                <%= @inward_dispatch.logistics_aggregator %>
              </div>
            <% end %>

            <% if @inward_dispatch.logistics_partner? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Logistics Partner</strong>
                <%= @inward_dispatch.logistics_partner %>
              </div>
            <% end %>

            <% if @inward_dispatch.tracking_number? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Tracking Number</strong>
                <%= @inward_dispatch.tracking_number %>
              </div>
            <% end %>

            <% if @inward_dispatch.expected_dispatch_date? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Expected Dispatch Date</strong>
                <%= format_date(@inward_dispatch.expected_dispatch_date) %>
              </div>
            <% end %>

            <% if @inward_dispatch.expected_delivery_date? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Expected Delivery Date</strong>
                <%= format_date(@inward_dispatch.expected_delivery_date) %>
              </div>
            <% end %>

            <% if @inward_dispatch.actual_delivery_date? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Actual Delivery Date</strong>
                <%= format_date(@inward_dispatch.actual_delivery_date) %>
              </div>
            <% end %>

            <% if @inward_dispatch.rows.present? %>
              <div class="col-6 col-md-3 mb-2">
                <strong class="d-block">Supplier Delivery Date(Overall)</strong>
                <%= @inward_dispatch.show_supplier_delivery_date %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

  </section>
  <section class="pb-4 pb-lg-5">
    <ul class="nav nav-tabs nav-fill">
      <% if @po_request.present? %>
        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#po_request" role="tab">Po Request</a>
        </li>
      <% end %>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#products" role="tab">Products</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#comments" role="tab">Comments</a>
      </li>
    </ul>

    <div class="tab-content">
      <% if @po_request.present? %>
        <div class="tab-pane fade active show" id="po_request" role="tabpanel">
          <div class="card mb-2">
            <div class="card-body">
              <div>
                <h6 class="text-uppercase text-black-50 mb-1">Details</h6>
                <div class="form-row">
                  <% if @po_request.sales_order.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Sales Order #</strong>
                      <%= link_to overseers_inquiry_sales_order_path(@po_request.inquiry, @po_request.sales_order), target: '_blank' do %>
                        <%= format_id(@po_request.sales_order.order_number) %>
                      <% end %>
                    </div>
                  <% end %>

                  <% if @po_request.inquiry.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Inquiry #</strong>
                      <% if policy(@po_request.inquiry).edit? %>
                        <%= link_to overseers_inquiry_path(@po_request.inquiry), target: '_blank' do %>
                          <%= format_id(@po_request.inquiry.inquiry_number) %>
                        <% end %>
                      <% else %>
                        <%= format_id(@po_request.sales_order.order_number) %>
                      <% end %>
                    </div>
                  <% end %>

                  <% if @po_request.status.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Status</strong>
                      <%= status_badge(@po_request.status) %>
                    </div>
                  <% end %>

                  <% if @po_request.inquiry.present? && @po_request.inquiry.inside_sales_owner.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Inside Sales</strong>
                      <%= @po_request.inquiry.inside_sales_owner.to_s %>
                    </div>
                  <% end %>

                  <% if @po_request.purchase_order.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Purchase Order #</strong>
                      <%= @po_request.purchase_order.po_number %>
                    </div>
                  <% end %>

                  <% if @po_request.payment_request.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Payment Request</strong>
                      <a href="<%= overseers_payment_request_path(@po_request.payment_request) %>"><%= format_id(@po_request.id) %></a>
                    </div>
                  <% end %>

                  <% if @po_request.sales_order.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Supplier PO Type</strong>
                      <%= @po_request.sales_order.opportunity_type.humanize %>
                    </div>
                  <% end %>

                  <% if @po_request.payment_option.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Payment Terms</strong>
                      <%= @po_request.payment_option %>
                    </div>
                  <% end %>

                  <% if @po_request.inquiry.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Customer Committed Date</strong>
                      <%= @po_request.inquiry.customer_committed_date %>
                    </div>
                  <% end %>
                  <div class="col-6 col-md-3 mb-2">
                    <strong class="d-block">Supplier Committed Delivery Date</strong>
                    <%= @po_request.supplier_committed_date %>
                  </div>
                  <% if @po_request.supplier.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Supplier</strong>
                      <%= @po_request.supplier.to_s %>
                    </div>
                  <% end %>


                  <% if @po_request.contact.present? %>
                    <div class="col-6 col-md-6 mb-2">
                      <strong class="d-block">Supplier Contact</strong>
                      <%= @po_request.contact.to_s %><br>
                      <% if @po_request.contact_email.present? %>
                        <strong>Email: </strong><%= @po_request.contact_email %><br>
                      <% end %>
                      <% if @po_request.contact_phone.present? %>
                        <strong>Phone: </strong><%= @po_request.contact_phone %>
                      <% end %>
                    </div>
                  <% end %>

                  <% if @po_request.bill_from.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Bill From</strong>
                      <%= @po_request.bill_from.to_s %>
                    </div>
                  <% end %>
                  <% if @po_request.ship_from.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Ship From</strong>
                      <%= @po_request.ship_from.to_s %>
                    </div>
                  <% end %>
                  <% if @po_request.bill_to.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Bill To</strong>
                      <%= @po_request.bill_to.address.to_multiline_s %>
                    </div>
                  <% end %>
                  <% if @po_request.ship_to.present? %>
                    <div class="col-6 col-md-3 mb-2">
                      <strong class="d-block">Ship To</strong>
                      <%= @po_request.ship_to.address.to_multiline_s %>
                    </div>
                  <% end %>
                </div>

                <% if @po_request.attachments.attached? %>
                  <div class="form-row">
                    <div class="col-10 col-md-3 mb-2">
                      <strong class="d-block">Attachments </strong>
                      <% @po_request.attachments.each do |attachment| %>
                        <%= link_to url_for(attachment), class: 'ml-md-1 btn btn-success', target: '_blank', :"data-toggle" => 'tooltip', :status => attachment.filename do %>
                          <i class="fal fa-download"></i>
                          <%= link_to overseers_attachment_path(attachment.id), class: 'btn btn-outline-danger btn-sm ml-1 mr-1 mr-md-0', method: :delete, data: {confirm: 'Are you sure?'}, :"data-toggle" => 'tooltip', :status => ['Delete', ' ', attachment.filename, '?'].join('') do %>
                            <i class="fal fa-trash-alt"></i>
                          <% end if attachment.present? && policy(:attachment).destroy? %>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                <% end %>

                <% if @po_request.comments.persisted.size > 0 %>
                  <div class="card">
                    <div class="card-body">
                      <div class="flex-fill">
                        <h6 class="text-uppercase text-black-50 mb-1">Comments History</h6>
                      </div>
                      <div class="chats">
                        <% @po_request.comments.each do |comment| %>
                          <%= format_comment(comment) %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <div class="tab-pane fade " id="products" role="tabpanel">
        <% if @inward_dispatch.rows.present? %>
          <div class="card mb-2">
            <div class="card-body">
              <div class="flex-fill">
                <h6 class="text-uppercase text-black-50 mb-1">Products</h6>
              </div>
              <div class="mt-3">
                <table class="table table-bordered dt-responsive wrap-whitespace w-100" data-fixed-header="false">
                  <thead>
                  <tr>
                    <th>Sr. No.</th>
                    <th>Product</th>
                    <th>Supplier PO Total Qty</th>
                    <th>Pending Delivery</th>
                    <th>Inward Dispatch Qty</th>
                    <th>Delivered Qty</th>
                  </tr>
                  </thead>
                  <tbody>
                  <% @inward_dispatch.rows.each_with_index do |row, sr_no| %>
                    <tr>
                      <td><%= sr_no + 1 %></td>
                      <td><%= row.purchase_order_row.to_s %></td>
                      <td><%= row.purchase_order_row.quantity %></td>
                      <td><%= row.pending_delivery %></td>
                      <td><%= row.pickup_quantity.to_i %></td>
                      <td><%= row.delivered_quantity.to_i %></td>
                    </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="tab-pane fade " id="comments" role="tabpanel">
        <div class="card">
          <% if @inward_dispatch.comments.persisted.size > 0 %>
            <div class="card-body">
              <h6 class="text-uppercase text-black-50 mb-1">Comments</h6>
              <div class="chats">
                <% @inward_dispatch.comments.persisted.each do |comment| %>
                  <%= format_comment(comment) %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </section>
</div>