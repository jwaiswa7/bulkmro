<% content_for :page_title do %>
  RFQ
<% end %>
<div class="col-lg-12">
    <%= simple_form_for([@inquiry_product_supplier], url: update_ips_suppliers_rfq_index_path, method: :PATCH, :html => {:class => 'needs-validation mt-3', :'novalidate' => '', :'data-parsley-validate' => ''}) do |f| %>
      <%= render 'shared/snippets/form_errors', f: f %>
      <div class="card">
        <div class="card-body">
          <div class="form-row">
            <div class="col-12">
              <div class="mt-3">
                <strong>
                  <%= f.hidden_field :id %>
                  <%= "Inquiry: ##{f.object.inquiry.inquiry_number}" %>
                </strong>
              </div>
            </div>
            <hr>
            <div class="col-12">
              <%#= f.fields_for :inquiry_product, f.object.inquiry_product do |inquiry_product| %>
              <div class="form-row d-none d-md-flex">
                <div class="col-6">
                  <div class="form-group mb-0">
                    <label>Product</label><br>
                    <%= @inquiry_product_supplier.product.to_s %>
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group mb-0">
                    <label>MPN</label><br>
                    <%= @inquiry_product_supplier.product.mpn %>
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group mb-0">
                    <label>Brand</label><br>
                    <%= @inquiry_product_supplier.product.brand.to_s %>
                  </div>
                </div>
              </div>
              <br>
              <div class="form-row d-none d-md-flex" id="rfq_edit">
                <div class="col-1">
                  <div class="form-group mb-0">
                    <%= f.input :quantity, :input_html => { :value => @inquiry_product_supplier.inquiry_product.quantity }, readonly: true %>
                  </div>
                </div>
                <div class="col-1">
                  <div class="form-group mb-0">
                    <%= f.input :lead_time, as: :string, input_html: {:'data-toggle' => 'datepicker'} %>
                  </div>
                </div>
                <% if f.object.last_unit_price.present? %>
                  <div class="col-2">
                    <div class="form-group mb-0">
                      <%= f.input :last_unit_price, input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''} %>
                    </div>
                  </div>
                <% end %>
                <div class="col-2">
                  <div class="form-group mb-0">
                    <%= f.input :unit_cost_price, label: 'Basic Unit Price', input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''} %>
                  </div>
                </div>
                <div class="col-1">
                  <div class="form-group mb-0">
                    <%= f.input :gst, label: 'GST%', input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''} %>
                  </div>
                </div>
                <div class="col-1">
                  <div class="form-group mb-0">
                    <%= f.input :unit_freight, input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''} %>
                  </div>
                </div>
                <div class="col-2">
                  <div class="form-group mb-0">
                    <%= f.input :final_unit_price, input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''}, readonly: true %>
                  </div>
                </div>
                <div class="col-2">
                  <div class="form-group mb-0">
                    <%= f.input :total_price, input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''}, readonly: true %>
                  </div>
                </div>
              </div>
              <div class="form-row d-none d-md-flex">
                <div class="col-10">
                  <div class="form-group mb-0">
                    <%= f.input :remarks, input_html: {:'data-parsley-errors-messages-disabled' => '', :'data-parsely-no-valid-feedback' => ''} %>
                  </div>
                </div>
              </div>
              <%# end %>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <%= button_tag(type: "submit", class: "btn btn-warning btn-block") do %>
            <i class="fal fa-pen"></i> Update RFQ
          <% end %>
        </div>
      </div>
    <% end %>
</div>
<div></div>
<% if @inquiry_product_supplier.supplier_rfq_revisions.present? %>
  <div class="col-lg-12">
    <div class="card mt-1">
      <div class="card-body">
        <h5 class="text-uppercase text-black-50 mb-0">RFQ Revision History</h5>
        <table class="table datatable w-100 wrap-whitespace" data-fixed-header="false">
          <thead>
          <tr>
            <th class="no-sort">Quantity</th>
            <th class="no-sort">Lead Time</th>
            <th class="no-sort">Last Unit Price</th>
            <th class="no-sort">Unit Cost Price</th>
            <th class="no-sort">GST</th>
            <th class="no-sort">Unit Freight</th>
            <th class="no-sort">Final Unit Price</th>
            <th class="no-sort">Total Price</th>
            <th class="no-sort">Created On</th>
          </tr>
          </thead>
          <tbody>
          <% @inquiry_product_supplier.supplier_rfq_revisions.each do |rfq_revision| %>
            <tr>
              <td><%= JSON.parse(rfq_revision.rfq_data)["quantity"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["lead_time"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["last_unit_price"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["unit_cost_price"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["gst"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["unit_freight"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["final_unit_price"] %></td>
              <td><%= JSON.parse(rfq_revision.rfq_data)["total_price"] %></td>
              <td><%= format_date_with_time(rfq_revision.created_at) %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>
